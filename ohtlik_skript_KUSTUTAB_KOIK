#!/bin/bash

# Defineerime kasutajad, keda ei tohi kustutada
protected_users=("oguser" "root")

# Funktsioon, mis kontrollib, kas kasutaja on kaitstud
is_protected_user() {
    local user="$1"
    for protected_user in "${protected_users[@]}"; do
        if [[ "$user" == "$protected_user" ]]; then
            return 0  # Kasutaja on kaitstud
        fi
    done
    return 1  # Kasutaja ei ole kaitstud
}

# Funktsioon, mis kustutab kõik kasutajad peale kaitstud kasutajate
delete_users() {
    echo "Kustutame kõik kasutajad peale: ${protected_users[*]}"
    
    # Käime läbi kõik kasutajad /etc/passwd failist
    while IFS=: read -r user _; do
        if ! is_protected_user "$user"; then
            echo "Kustutame kasutaja: $user"
            sudo userdel -r "$user"  # Kustuta kasutaja koos kodu kataloogiga
        fi
    done < /etc/passwd
}

# Peamine skripti loogika
read -p "Kas olete kindel, et soovite kustutada kõik kasutajad peale ${protected_users[*]}? (y/n): " confirm
if [[ "$confirm" =~ ^[Yy]$ ]]; then
    delete_users
    echo "Kasutajad on kustutatud."
else
    echo "Kasutajate kustutamine tühistatud."
fi
